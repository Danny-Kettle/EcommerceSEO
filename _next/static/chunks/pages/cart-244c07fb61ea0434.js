(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[190],{8086:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/cart",function(){return n(6664)}])},6664:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return w}});var r=n(5893),s=n(1301),a=n(9633),i=n(7294),c="https://js.stripe.com/v3",o=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,l=function(){for(var e=document.querySelectorAll('script[src^="'.concat(c,'"]')),t=0;t<e.length;t++){var n=e[t];if(o.test(n.src))return n}return null},d=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",n=document.createElement("script");n.src="".concat(c).concat(t);var r=document.head||document.body;if(!r)throw Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return r.appendChild(n),n},u=function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"1.52.1",startTime:t})},m=null,p=function(e,t,n){if(null===e)return null;var r=e.apply(void 0,t);return u(r,n),r},h=Promise.resolve().then(function(){return null!==m?m:m=new Promise(function(e,t){if("undefined"==typeof window||"undefined"==typeof document){e(null);return}if(window.Stripe,window.Stripe){e(window.Stripe);return}try{var n=l();n||(n=d(null)),n.addEventListener("load",function(){window.Stripe?e(window.Stripe):t(Error("Stripe.js not available"))}),n.addEventListener("error",function(){t(Error("Failed to load Stripe.js"))})}catch(e){t(e);return}})}),x=!1;h.catch(function(e){x||console.warn(e)});var f=n(2134),g=n(9008),y=n.n(g);let j=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];x=!0;var r=Date.now();return h.then(function(e){return p(e,t,r)})}("pk_test_51Mx4rPH5AhzLlnQZ4YPJVwhq3cQzMcZi6gP4Ghk4ROFBGQ0Uj3drZZO3zB8g3NkD9UPs5GBbPoanhYuWF22zrgHW00yhuQLc6A");function w(){let{cartItems:e,incrementItem:t,decrementItem:n,removeFromCart:c}=(0,a.jD)(),{products:o}=(0,f.rn)();console.log(o),console.log(e);let[l,d]=(0,i.useState)(!1),[u,m]=(0,i.useState)(null),p=async()=>{for(let t of e){let e=await o.find(e=>e._id===t._id);if(e.stock<t.quantity)return await m(e),e}return m(null),null},h=async()=>{d(!0);let t=await p();if(console.log(t),null!==t)console.log("Not Enough Stock"),window.scrollTo(0,0);else{let t=await j,n=Object.values(e).map(e=>({price_data:{currency:"GBP",product_data:{name:e.name},unit_amount:parseInt(e.price.replace(/\D/g,""))},quantity:e.quantity})),r=await fetch("/api/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({line_items:n,success_url:window.location.origin+"/success",cancel_url:window.location.origin+"/cart"})}),s=await r.json();await t.redirectToCheckout({sessionId:s.id})}d(!1)},x=e?Object.values(e).reduce((e,t)=>e+parseFloat(t.price)*parseInt(t.quantity),0):0,g=new Intl.NumberFormat("en-UK",{style:"currency",currency:"GBP"}).format(x),w=(e,t)=>{1===t?c(e):n(e)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(y(),{children:[(0,r.jsx)("title",{children:"Echo Cart | Review and Edit Your Order"}),(0,r.jsx)("meta",{name:"description",content:"Review and edit your order at Echo. Add or remove items from your cart and proceed to checkout. Fast and free shipping available on eligible orders."}),(0,r.jsx)("meta",{name:"keywords",content:"Echo, cart, review, edit, order, audio, laptops, mobiles, headphones, speakers, smartphones, tablets, computers, gaming laptops, MacBook, Dell, HP, Lenovo, Samsung, Apple, Sony, Bose, JBL, Sennheiser, Beats, Asus"})]}),(0,r.jsx)(s.Z,{children:(0,r.jsxs)("div",{className:"max-w-screen-md w-11/12 mx-auto py-12 px-4 sm:px-6 lg:py-16 lg:px-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-extrabold mb-4 lg:mb-8 tracking-tight text-gray-900 sm:text-4xl",children:"Shopping Cart"}),e.length<=0?(0,r.jsx)("p",{className:"mt-6 text-lg text-gray-500",children:"Your cart is currently empty."}):(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsx)("div",{className:"flow-root",children:(0,r.jsx)("ul",{className:"-my-4 divide-y divide-gray-200",children:Object.values(e).map(e=>(0,r.jsxs)("li",{className:"flex py-4",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)("img",{className:"h-20 w-20 rounded-md object-cover",src:e.picture,alt:e.name})}),(0,r.jsxs)("div",{className:"ml-4 flex-1 flex flex-col justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-gray-900 font-semibold",children:e.name}),(0,r.jsx)("p",{className:"mt-1 text-gray-500 text-sm",children:e.description})]}),(0,r.jsxs)("div",{className:"mt-4 flex-1 flex items-end justify-between",children:[(0,r.jsxs)("p",{className:"text-gray-500",children:["\xa3",e.price]}),(0,r.jsxs)("div",{className:"flex items-center justify-end space-x-4",children:[(0,r.jsx)("button",{type:"button",className:"font-medium text-gray-500 hover:text-gray-800",onClick:()=>w(e._id,e.quantity),children:"-"}),(0,r.jsx)("span",{className:"text-gray-700",children:e.quantity}),(0,r.jsx)("button",{type:"button",className:"font-medium text-gray-500 hover:text-gray-800",onClick:()=>t(e._id),children:"+"})]})]}),u&&u._id===e._id&&(0,r.jsx)("p",{className:"mt-6 text-red-600 text-sm",children:"Not enough stock, try again after cart."})]})]},e._id))})}),(0,r.jsx)("div",{className:"mt-6",children:(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Total"}),(0,r.jsx)("p",{className:"text-lg font-medium text-gray-900",children:g})]}),(0,r.jsx)("div",{className:"mt-2 text-sm text-gray-500",children:"Shipping and taxes calculated at checkout."}),(0,r.jsx)("div",{className:"mt-6",children:(0,r.jsx)("button",{onClick:h,type:"button",id:"checkoutBtn",className:"flex justify-center items-center px-6 py-3 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-gray-900 hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-900",children:"Checkout"})})]})})]})})]})})]})}},9008:function(e,t,n){e.exports=n(2636)}},function(e){e.O(0,[424,301,774,888,179],function(){return e(e.s=8086)}),_N_E=e.O()}]);